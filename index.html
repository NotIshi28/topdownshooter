<html><head>
    <title>Top Down RPG Shooter</title>
    <style>
        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            font-family: 'Press Start 2P', cursive;
            background-color: #1a1a1a;
            color: #00ff00;
            overflow: hidden;
        }
        #game-container {
            width: 100%;
            height: 100%;
            position: relative;
        }
        #game-canvas {
            width: 100%;
            height: 100%;
            display: block;
        }
        #hud {
            position: absolute;
            top: 1vh;
            left: 1vw;
            font-size: 1.4vh;
            background-color: rgba(0,0,0,0.7);
            padding: 1vh;
            border-radius: 0.5vh;
            border: 0.2vh solid #00ff00;
        }
        #menu-container {
            display: none;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(0,0,0,0.8);
            padding: 2vh;
            border: 0.2vh solid #00ff00;
            width: 30vw;
            max-width: 400px;
            border-radius: 1vh;
        }
        .tab-buttons {
            display: flex;
            justify-content: space-around;
            margin-bottom: 2vh;
        }
        .tab-button {
            background-color: #333;
            color: #00ff00;
            border: none;
            padding: 1vh 2vw;
            cursor: pointer;
            font-family: 'Press Start 2P', cursive;
            font-size: 1.2vh;
            border-radius: 0.5vh;
        }
        .tab-button.active {
            background-color: #00ff00;
            color: #333;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .menu-item {
            margin: 1vh 0;
            cursor: pointer;
            transition: color 0.3s ease;
            font-size: 1.2vh;
        }
        .menu-item:hover {
            color: #ff0000;
        }
        .menu-item.sold-out {
            color: #888;
            cursor: not-allowed;
        }
        .menu-item.highlight {
            color: #ffff00;
        }
        .shop-section {
            margin-bottom: 2vh;
        }
        .shop-section-title {
            color: #ff9900;
            font-size: 1.6vh;
            margin-bottom: 1vh;
        }
        #controls {
            position: absolute;
            bottom: 1vh;
            left: 1vw;
            font-size: 1.2vh;
            background-color: rgba(0,0,0,0.7);
            padding: 1vh;
            border-radius: 0.5vh;
            border: 0.2vh solid #00ff00;
        }
        #game-over {
            display: none;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(0,0,0,0.8);
            padding: 2vh;
            border: 0.2vh solid #ff0000;
            text-align: center;
            border-radius: 1vh;
            font-size: 1.4vh;
        }
        #wave-announcement {
            display: none;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 3.6vh;
            color: #ff0000;
            text-shadow: 0.2vh 0.2vh #000000;
        }
        #title-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.9);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        #title-screen h1 {
            font-size: 5vh;
            color: #ff0000;
            text-shadow: 0.3vh 0.3vh #00ff00;
            margin-bottom: 3vh;
        }
        #name-input {
            font-size: 1.8vh;
            padding: 1vh;
            width: 30vw;
            max-width: 300px;
            margin-bottom: 2vh;
            background-color: #333;
            color: #00ff00;
            border: 0.2vh solid #00ff00;
            font-family: 'Press Start 2P', cursive;
        }
        #start-game {
            font-size: 2.4vh;
            padding: 1.5vh 3vw;
            background-color: #00ff00;
            color: #000;
            border: none;
            cursor: pointer;
            font-family: 'Press Start 2P', cursive;
        }
        #credits {
            position: absolute;
            bottom: 1vh;
            right: 1vw;
            font-size: 1.2vh;
            color: #888;
        }
    </style>
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
</head><body>
<div id="game-container">
    <canvas id="game-canvas"></canvas>
    <div id="hud">
        Health: <span id="health">100</span>/<span id="max-health">100</span> | XP: <span id="xp">0</span> | Level: <span id="level">1</span><br>
        Weapon: <span id="weapon">Pistol (Lv.1)</span> | Wave: <span id="wave">1</span>
    </div>
    <div id="menu-container">
        <div class="tab-buttons">
            <button class="tab-button active" onclick="openTab('menu')">Menu</button>
            <button class="tab-button" onclick="openTab('shop')">Shop</button>
            <button class="tab-button" onclick="openTab('inventory')">Inventory</button>
        </div>
        <div id="menu" class="tab-content active">
            <h2><span id="player-name">Terry Loot</span></h2>
            <p>Level: <span id="menu-level">1</span></p>
            <p>Health: <span id="menu-health">100</span>/<span id="menu-max-health">100</span></p>
            <p>Weapon: <span id="menu-weapon">Pistol (Lv.1)</span></p>
            <p>XP: <span id="menu-xp">0</span></p>
            <div class="menu-item" onclick="resumeGame()">Resume Game</div>
        </div>
        <div id="shop" class="tab-content">
            <h2>Shop</h2>
            <div class="shop-section">
                <div class="shop-section-title">Weapons</div>
                <div id="shotgun-buy" class="menu-item" onclick="buyWeapon('Shotgun', 200)">Buy Shotgun (200 XP)</div>
                <div id="smg-buy" class="menu-item" onclick="buyWeapon('SMG', 500)">Buy SMG (500 XP)</div>
                <div id="sniper-buy" class="menu-item" onclick="buyWeapon('Sniper', 1000)">Buy Sniper (1000 XP)</div>
                <div id="minigun-buy" class="menu-item" onclick="buyWeapon('Minigun', 2000)">Buy Minigun (2000 XP)</div>
            </div>
            <div class="shop-section">
                <div class="shop-section-title">Upgrades</div>
                <div class="menu-item" id="upgrade-weapon" onclick="upgradeWeapon()">Upgrade Weapon (100 XP)</div>
                <div class="menu-item" id="upgrade-speed" onclick="upgradeSpeed()">Upgrade Speed (150 XP)</div>
            </div>
            <div class="shop-section">
                <div class="shop-section-title">Healing</div>
                <div class="menu-item" id="heal-character" onclick="healCharacter()">Heal (50 XP)</div>
            </div>
        </div>
        <div id="inventory" class="tab-content">
            <h2>Inventory</h2>
            <p>Level: <span id="inventory-level">1</span></p>
            <div id="inventory-weapons"></div>
        </div>
    </div>
    <div id="controls">
        Controls: WASD - Move | Mouse - Aim | Hold Left Click - Shoot | TAB - Menu/Shop | SHIFT - Slow Movement
    </div>
    <div id="game-over">
        <h2>Game Over!</h2>
        <p>You reached wave <span id="final-wave"></span></p>
        <div class="menu-item" onclick="restartGame()">Play Again</div>
    </div>
    <div id="wave-announcement"></div>
    <div id="title-screen">
        <h1>ZombieFest</h1>
        <input type="text" id="name-input" placeholder="Enter your name" value="Terry Loot">
        <button id="start-game" onclick="startGame()">Start Game</button>
    </div>
    <div id="credits">
        AI Directed By: StickGuy<br>
        Programmed By: AI
    </div>
</div>

<script>
const canvas = document.getElementById('game-canvas');
const ctx = canvas.getContext('2d');
const player = {
    name: "Terry Loot",
    x: 400,
    y: 300,
    baseSpeed: 5,
    currentSpeed: 5,
    slowSpeed: 2.5,
    health: 100,
    maxHealth: 100,
    xp: 0,
    level: 1,
    weapon: { name: "Pistol", level: 1, damage: 10, fireRate: 1, bulletCount: 1, spread: 0 },
    movementX: 0,
    movementY: 0,
    damageEffect: 0,
    deathAnimation: null,
    acceleration: 0.5,
    deceleration: 0.8,
    maxSpeed: 7,
    velocity: { x: 0, y: 0 }
};
let zombies = [];
let bullets = [];
let zombieBullets = [];
let gameLoop;
let menuOpen = false;
let gameActive = false;
let gamePaused = false;
let keys = {};
let lastShot = 0;
let mouseX = 0;
let mouseY = 0;
let isShooting = false;
let currentWave = 1;
let zombiesInWave = 5;
let zombiesSpawned = 0;
let zombiesKilled = 0;
let isSlowMovement = false;
let upgradeWeaponCost = 100;
let upgradeSpeedCost = 150;
let healCost = 50;
let upgradeWeaponCount = 0;
let upgradeSpeedCount = 0;
let healCount = 0;
let inventory = {
    Pistol: { level: 1, damage: 10, fireRate: 1, bulletCount: 1, spread: 0 }
};
let deathAnimations = [];

const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
let backgroundMusic;

function loadBackgroundMusic() {
    const request = new XMLHttpRequest();
    request.open('GET', 'https://example.com/phonk_music.mp3', true);
    request.responseType = 'arraybuffer';

    request.onload = function() {
        audioCtx.decodeAudioData(request.response, function(buffer) {
            backgroundMusic = buffer;
            playBackgroundMusic();
        });
    }
    request.send();
}

function playBackgroundMusic() {
    const source = audioCtx.createBufferSource();
    source.buffer = backgroundMusic;
    source.connect(audioCtx.destination);
    source.loop = true;
    source.start();
}

function createOscillator(freq, type, duration) {
    const oscillator = audioCtx.createOscillator();
    const gainNode = audioCtx.createGain();
    
    oscillator.type = type;
    oscillator.frequency.setValueAtTime(freq, audioCtx.currentTime);
    
    gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime);
    gainNode.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + duration);
    
    oscillator.connect(gainNode);
    gainNode.connect(audioCtx.destination);
    
    oscillator.start();
    oscillator.stop(audioCtx.currentTime + duration);
}
function playShootSound() {
    createOscillator(200, 'square', 0.1);
}

function playMenuSound() {
    createOscillator(440, 'sine', 0.1);
}

function playDeathSound() {
    createOscillator(100, 'sawtooth', 0.3);
}

function resizeCanvas() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
}

window.addEventListener('resize', resizeCanvas);
resizeCanvas();

function startGame() {
    const nameInput = document.getElementById('name-input');
    player.name = nameInput.value || "Terry Loot";
    document.getElementById('title-screen').style.display = 'none';
    gameActive = true;
    updateHUD();
    announceWave();
    loadBackgroundMusic();
}

function drawPlayer() {
    if (player.deathAnimation) {
        drawDeathAnimation(player.deathAnimation);
    } else {
        ctx.fillStyle = player.damageEffect > 0 ? `rgba(255,0,0,${player.damageEffect})` : '#00ff00';
        ctx.beginPath();
        ctx.arc(player.x, player.y, 20, 0, Math.PI * 2);
        ctx.fill();
        
        if (player.damageEffect > 0) {
            player.damageEffect -= 0.05;
        }
    }
}

function drawZombies() {
    zombies.forEach(zombie => {
        if (zombie.deathAnimation) {
            drawDeathAnimation(zombie.deathAnimation);
        } else {
            let baseColor;
            switch(zombie.type) {
                case 'normal':
                    baseColor = [255, 0, 0];
                    break;
                case 'fast':
                    baseColor = [255, 136, 0];
                    break;
                case 'big':
                    baseColor = [136, 0, 0];
                    break;
                case 'shooter':
                    baseColor = [255, 0, 255];
                    break;
            }
            
            let damageColor = zombie.damageEffect > 0 ? [255, 255, 255] : baseColor;
            let blendedColor = baseColor.map((channel, index) => 
                Math.floor(channel * (1 - zombie.damageEffect) + damageColor[index] * zombie.damageEffect)
            );
            
            ctx.fillStyle = `rgb(${blendedColor.join(',')})`;
            ctx.beginPath();
            ctx.arc(zombie.x, zombie.y, zombie.type === 'big' ? 25 : 15, 0, Math.PI * 2);
            ctx.fill();
            
            if (zombie.damageEffect > 0) {
                zombie.damageEffect -= 0.1;
            }
        }
    });
}

function drawDeathAnimation(animation) {
    ctx.beginPath();
    ctx.arc(animation.x, animation.y, animation.radius, 0, Math.PI * 2);
    ctx.fillStyle = `rgba(${animation.color.join(',')},${animation.opacity})`;
    ctx.fill();
}

function updateDeathAnimations() {
    deathAnimations = deathAnimations.filter(animation => {
        animation.radius += 2;
        animation.opacity -= 0.05;
        drawDeathAnimation(animation);
        return animation.opacity > 0;
    });
}

function drawBullets() {
    ctx.fillStyle = '#ffff00';
    bullets.forEach(bullet => {
        ctx.beginPath();
        ctx.arc(bullet.x, bullet.y, 5, 0, Math.PI * 2);
        ctx.fill();
    });
    
    ctx.fillStyle = '#ff00ff';
    zombieBullets.forEach(bullet => {
        ctx.beginPath();
        ctx.arc(bullet.x, bullet.y, 3, 0, Math.PI * 2);
        ctx.fill();
    });
}
</script></body></html>